<?php

namespace Aszone\Vulnerabilities;

abstract class Vulnerability
{
    public $targets;

    public $target;

    public $tor;

    public $commandData;

    public function check()
    {
        $result = array();

        if (! $this->targets) {
            return $result;
        }

        foreach ($this->targets as $keySearchEngenier => $searchEngenier) {
            $target = $this->checkTarget($searchEngenier);

            $result = array_merge($target, $result);
        }

        return $result;
    }

    private function checkTarget(array $searchEngenier)
    {
        $result = array();

        foreach ($searchEngenier as $keyTarget => $target) {
            $this->target = urldecode(urldecode($target));

            $resultValid = $this->checkSuccess();

            if ($resultValid) {
                $result[] = $resultValid;
            }
        }

        return $result;
    }

    protected function getErrorsOfList()
    {
        $errorsMysql = parse_ini_file(__DIR__ . '/resource/Errors/mysql.ini');
        $errorsMariaDb = parse_ini_file(__DIR__ . '/resource/Errors/mariadb.ini');
        $errorsOracle = parse_ini_file(__DIR__ . '/resource/Errors/oracle.ini');
        $errorssqlServer = parse_ini_file(__DIR__ . '/resource/Errors/sqlserver.ini');
        $errorsPostgreSql = parse_ini_file(__DIR__ . '/resource/Errors/postgresql.ini');
        $errorsAsp = parse_ini_file(__DIR__ . '/resource/Errors/asp.ini');
        $errorsPhp = parse_ini_file(__DIR__ . '/resource/Errors/php.ini');

        return array_merge($errorsMysql, $errorsMariaDb, $errorsOracle, $errorssqlServer, $errorsPostgreSql);
    }

    protected function defaultEnterData()
    {
        $dataDefault['dork'] = false;
        $dataDefault['pl'] = false;
        $dataDefault['tor'] = false;
        $dataDefault['torl'] = false;
        $dataDefault['virginProxies'] = false;
        $dataDefault['proxyOfSites'] = false;

        return $dataDefault;
    }

    protected abstract function checkSuccess();

    protected abstract function setAttack();
}
